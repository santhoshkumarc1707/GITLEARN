import React, { useRef, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faArrowRight } from '@fortawesome/free-solid-svg-icons';
import { Modal } from 'react-bootstrap';
import SignatureCanvas from 'react-signature-canvas';
import axios from 'axios';
import './popup.scss';

const Popup = ({ names, position, address, path, content, show }) => {
    const navigate = useNavigate();
    const sigRef = useRef();
    const [dataurl, setDataurl] = useState(null);
    const [signature, setSignature] = useState(null);
    const [isPosting, setIsPosting] = useState(false);

    const clearSignature = () => {
        sigRef.current.clear();
        setSignature(null);
        setDataurl(null);
    };

    const handleNavigate = () => {
        navigate(path);
    };

    const handlePost = () => {
        const dataUrl = sigRef.current.toDataURL();
        setDataurl(dataUrl);
        setIsPosting(true);

        axios.post('/api/upload-signature', { signature: dataUrl })
            .then(response => {
                console.log('Signature posted successfully:', response.data);
                setIsPosting(false);
            })
            .catch(error => {
                console.error('Error posting signature:', error);
                setIsPosting(false);
            });
    };

    console.log(dataurl);

    return (
        <Modal show={show} backdrop="static" dialogClassName='crop-detail-edit-modal'>
            <Modal.Body>
                <div className='popup-div'>
                    <div className='signature-container'>
                        <SignatureCanvas
                            penColor="green"
                            canvasProps={{ className: 'signature' }}
                            ref={sigRef}
                        />
                    </div>
                    <button onClick={clearSignature}>Clear</button>
                    <h2>{names}</h2>
                    <h3>{position}</h3>
                    <h4>{address}</h4>
                </div>
            </Modal.Body>
            <Modal.Footer>
                <button className="btn" onClick={handlePost} disabled={isPosting}>
                    Post Signature
                </button>
                <button className="btn" onClick={handleNavigate}>
                    {content} <FontAwesomeIcon icon={faArrowRight} />
                </button>
            </Modal.Footer>
        </Modal>
    );
};

export default Popup;
